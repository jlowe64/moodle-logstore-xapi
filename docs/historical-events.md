# Guide to Historical Events
Hey there ðŸ‘‹  so you want to process some events from the past ðŸ•“, probably a time when this plugin wasn't installed on your Moodle. That's awesome, and we really want to help with 
that. We do have a recommended process for inserting these events.

Our process leverages the plugin's existing "background mode" (which is enabled by default in the plugin settings). In background mode, the plugin receives events from Moodle as 
they happen and stores them into the _mdl_logstore_xapi_log_ table to be processed later by the [Moodle Cron](https://docs.moodle.org/35/en/Cron) (which you should have set up 
already on your server). When the Moodle Cron script is executed, the plugin extracts, transforms, and loads the events from the _mdl_logstore_xapi_log_ table into the LRS and 
then deletes the events from the _mdl_logstore_xapi_log_ table.

To leverage this for events that happened before the plugin was installed, you'll need to move events from the _mdl_logstore_standard_log_ table into the _mdl_logstore_xapi_log_ 
table. This can be done by running an SQL query like the one below.
The list of statements contains all supported statements and can be modified according to your needs.

```SQL
INSERT INTO mdl_logstore_xapi_log (eventname, component, action, target, objecttable, objectid, crud,  edulevel, contextid, contextlevel, contextinstanceid, userid, courseid, relateduserid, anonymous, other, timecreated, origin,ip, realuserid,logstorestandardlogid,TYPE)
SELECT L.eventname, L.component, L.action, L.target, L.objecttable, L.objectid, L.crud,  L.edulevel, L.contextid, L.contextlevel, L.contextinstanceid, L.userid, L.courseid, L.relateduserid, L.anonymous, L.other, L.timecreated, L.origin,L.ip, L.realuserid,L.id,0
FROM mdl_logstore_standard_log AS L
WHERE L.userid IN (
  SELECT DISTINCT userid
  FROM mdl_enrol  AS E
         INNER JOIN mdl_user_enrolments AS UE
                    ON E.id = UE.enrolid
  WHERE ( E.courseid = 1 OR E.courseid = 2 OR E.courseid = 3 OR E.courseid = 4 OR E.courseid = 5 OR E.courseid = 6) AND L.userid>1
    AND L.eventname IN (
                        '\\core\\event\\badge_listing_viewed',
                        '\\core\\event\\badge_viewed',
                        '\\core\\event\\course_category_viewed',
                        '\\core\\event\\course_completed',
                        '\\core\\event\\course_information_viewed',
                        '\\core\\event\\course_module_completion_updated',
                        '\\core\\event\\course_resources_list_viewed',
                        '\\core\\event\\courses_searched',
                        '\\core\\event\\course_user_report_viewed',
                        '\\core\\event\\course_viewed',
                        '\\core\\event\\dashboard_viewed',
                        '\\core\\event\\dashboard_reset',
                        '\\core\\event\\group_message_sent',
                        '\\core\\event\\message_deleted',
                        '\\core\\event\\message_sent',
                        '\\core\\event\\message_viewed',
                        '\\core\\event\\grade_item_created',
                        '\\core\\event\\grade_item_updated',
                        '\\core\\event\\group_member_added',
                        '\\core\\event\\group_member_removed',
                        '\\core\\event\\notification_sent',
                        '\\core\\event\\notification_viewed',
                        '\\core\\event\\recent_activity_viewed',
                        '\\core\\event\\role_assigned',
                        '\\core\\event\\role_unassigned',
                        '\\core\\event\\role_updated',
                        '\\core\\event\\search_results_viewed',
                        '\\core\\event\\user_created',
                        '\\core\\event\\user_deleted',
                        '\\core\\event\\user_enrolment_created',
                        '\\core\\event\\user_enrolment_deleted',
                        '\\core\\event\\user_enrolment_updated',
                        '\\core\\event\\user_list_viewed',
                        '\\core\\event\\user_loggedin',
                        '\\core\\event\\user_loggedout',
                        '\\core\\event\\user_profile_viewed',
                        '\\core\\event\\user_updated',
                        '\\mod_assign\\event\\assessable_submitted',
                        '\\mod_assign\\event\\course_module_instance_list_viewed',
                        '\\mod_assign\\event\\course_module_viewed',
                        '\\mod_assign\\event\\feedback_viewed',
                        '\\mod_assign\\event\\remove_submission_form_viewed',
                        '\\mod_assign\\event\\submission_confirmation_form_viewed',
                        '\\mod_assign\\event\\submission_duplicated',
                        '\\mod_assign\\event\\submission_form_viewed',
                        '\\mod_assign\\event\\submission_graded',
                        '\\mod_assign\\event\\submission_status_viewed',
                        '\\mod_assign\\event\\submission_viewed',
                        '\\assignsubmission_comments\\event\\comment_created',
                        '\\assignsubmission_comments\\event\\comment_deleted',
                        '\\assignsubmission_file\\event\\assessable_uploaded',
                        '\\assignsubmission_file\\event\\submission_created',
                        '\\assignsubmission_file\\event\\submission_updated',
                        '\\assignsubmission_onlinetext\\event\\assessable_uploaded',
                        '\\assignsubmission_onlinetext\\event\\submission_created',
                        '\\assignsubmission_onlinetext\\event\\submission_updated',
                        '\\mod_attendance\\event\\attendance_taken_by_student',
                        '\\mod_attendance\\event\\course_module_instance_list_viewed',
                        '\\mod_attendance\\event\\session_report_viewed',
                        '\\mod_bigbluebuttonbn\\event\\activity_viewed',
                        '\\mod_bigbluebuttonbn\\event\\activity_management_viewed',
                        '\\mod_bigbluebuttonbn\\event\\live_session_event',
                        '\\mod_bigbluebuttonbn\\event\\meeting_created',
                        '\\mod_bigbluebuttonbn\\event\\meeting_ended',
                        '\\mod_bigbluebuttonbn\\event\\meeting_joined',
                        '\\mod_bigbluebuttonbn\\event\\meeting_left',
                        '\\mod_bigbluebuttonbn\\event\\recording_deleted',
                        '\\mod_bigbluebuttonbn\\event\\recording_edited',
                        '\\mod_bigbluebuttonbn\\event\\recording_imported',
                        '\\mod_bigbluebuttonbn\\event\\recording_protected',
                        '\\mod_bigbluebuttonbn\\event\\recording_published',
                        '\\mod_bigbluebuttonbn\\event\\recording_unprotected',
                        '\\mod_bigbluebuttonbn\\event\\recording_unpublished',
                        '\\mod_bigbluebuttonbn\\event\\recording_viewed',
                        '\\block_comments\\event\\comment_created',
                        '\\block_comments\\event\\comment_deleted',
                        '\\booktool_print\\event\\book_printed',
                        '\\booktool_print\\event\\chapter_printed',
                        '\\mod_book\\event\\chapter_viewed',
                        '\\mod_book\\event\\course_module_instance_list_viewed',
                        '\\mod_book\\event\\course_module_viewed',
                        '\\mod_chat\\event\\course_module_instance_list_viewed',
                        '\\mod_chat\\event\\course_module_viewed',
                        '\\mod_chat\\event\\message_sent',
                        '\\mod_chat\\event\\sessions_viewed',
                        '\\mod_checklist\\event\\checklist_completed',
                        '\\mod_checklist\\event\\course_module_instance_list_viewed',
                        '\\mod_checklist\\event\\course_module_viewed',
                        '\\mod_checklist\\event\\student_checks_updated',
                        '\\mod_choice\\event\\answer_created',
                        '\\mod_choice\\event\\answer_deleted',
                        '\\mod_choice\\event\\course_module_instance_list_viewed',
                        '\\mod_choice\\event\\course_module_viewed',
                        '\\mod_choicegroup\\event\\choice_removed',
                        '\\mod_choicegroup\\event\\choice_updated',
                        '\\mod_choicegroup\\event\\course_module_instance_list_viewed',
                        '\\mod_data\\event\\comment_created',
                        '\\mod_data\\event\\comment_deleted',
                        '\\mod_data\\event\\course_module_instance_list_viewed',
                        '\\mod_data\\event\\course_module_viewed',
                        '\\mod_data\\event\\record_created',
                        '\\mod_data\\event\\record_deleted',
                        '\\mod_data\\event\\record_updated',
                        '\\mod_facetoface\\event\\cancel_booking',
                        '\\mod_facetoface\\event\\course_module_viewed',
                        '\\mod_facetoface\\event\\signup_success',
                        '\\mod_facetoface\\event\\take_attendance',
                        '\\mod_feedback\\event\\course_module_instance_list_viewed',
                        '\\mod_feedback\\event\\course_module_viewed',
                        '\\mod_feedback\\event\\response_submitted',
                        '\\mod_feedback\\event\\response_deleted',
                        '\\mod_folder\\event\\all_files_downloaded',
                        '\\mod_folder\\event\\course_module_instance_list_viewed',
                        '\\mod_folder\\event\\course_module_viewed',
                        '\\mod_forum\\event\\assessable_uploaded',
                        '\\mod_forum\\event\\course_module_instance_list_viewed',
                        '\\mod_forum\\event\\course_module_viewed',
                        '\\mod_forum\\event\\course_searched',
                        '\\mod_forum\\event\\discussion_created',
                        '\\mod_forum\\event\\discussion_deleted',
                        '\\mod_forum\\event\\discussion_viewed',
                        '\\mod_forum\\event\\discussion_subscription_created',
                        '\\mod_forum\\event\\discussion_subscription_deleted',
                        '\\mod_forum\\event\\post_created',
                        '\\mod_forum\\event\\post_deleted',
                        '\\mod_forum\\event\\post_updated',
                        '\\mod_forum\\event\\readtracking_disabled',
                        '\\mod_forum\\event\\readtracking_enabled',
                        '\\mod_forum\\event\\subscription_created',
                        '\\mod_forum\\event\\subscription_deleted',
                        '\\mod_forum\\event\\user_report_viewed',
                        '\\mod_glossary\\event\\course_module_instance_list_viewed',
                        '\\mod_glossary\\event\\course_module_viewed',
                        '\\mod_glossary\\event\\comment_created',
                        '\\mod_glossary\\event\\comment_deleted',
                        '\\mod_glossary\\event\\entry_created',
                        '\\mod_glossary\\event\\entry_deleted',
                        '\\mod_glossary\\event\\entry_updated',
                        '\\mod_glossary\\event\\entry_viewed',
                        '\\gradereport_overview\\event\\grade_report_viewed',
                        '\\gradereport_user\\event\\grade_report_viewed',
                        '\\mod_choicegroup\\event\\course_module_viewed',
                        '\\mod_h5pactivity\\event\\course_module_instance_list_viewed',
                        '\\mod_h5pactivity\\event\\course_module_viewed',
                        '\\mod_h5pactivity\\event\\report_viewed',
                        '\\mod_h5pactivity\\event\\statement_received',
                        '\\mod_imscp\\event\\course_module_instance_list_viewed',
                        '\\mod_imscp\\event\\course_module_viewed',
                        '\\mod_lesson\\event\\content_page_viewed',
                        '\\mod_lesson\\event\\course_module_instance_list_viewed',
                        '\\mod_lesson\\event\\course_module_viewed',
                        '\\mod_lesson\\event\\lesson_ended',
                        '\\mod_lesson\\event\\lesson_restarted',
                        '\\mod_lesson\\event\\lesson_resumed',
                        '\\mod_lesson\\event\\lesson_started',
                        '\\mod_lesson\\event\\question_answered',
                        '\\mod_lesson\\event\\question_viewed',
                        '\\mod_lti\\event\\course_module_instance_list_viewed',
                        '\\mod_lti\\event\\course_module_viewed',
                        '\\mod_page\\event\\course_module_instance_list_viewed',
                        '\\mod_page\\event\\course_module_viewed',
                        '\\mod_questionnaire\\event\\all_responses_viewed',
                        '\\mod_questionnaire\\event\\attempt_resumed',
                        '\\mod_questionnaire\\event\\attempt_saved',
                        '\\mod_questionnaire\\event\\attempt_submitted',
                        '\\mod_questionnaire\\event\\course_module_instance_list_viewed',
                        '\\mod_questionnaire\\event\\course_module_viewed',
                        '\\mod_questionnaire\\event\\response_viewed',
                        '\\mod_quiz\\event\\attempt_abandoned',
                        '\\mod_quiz\\event\\attempt_started',
                        '\\mod_quiz\\event\\attempt_reviewed',
                        '\\mod_quiz\\event\\attempt_submitted',
                        '\\mod_quiz\\event\\attempt_summary_viewed',
                        '\\mod_quiz\\event\\attempt_viewed',
                        '\\mod_quiz\\event\\course_module_instance_list_viewed',
                        '\\mod_quiz\\event\\course_module_viewed',
                        '\\mod_resource\\event\\course_module_instance_list_viewed',
                        '\\mod_resource\\event\\course_module_viewed',
                        '\\mod_scheduler\\event\\course_module_instance_list_viewed',
                        '\\mod_scheduler\\event\\booking_added',
                        '\\mod_scheduler\\event\\booking_form_viewed',
                        '\\mod_scheduler\\event\\booking_removed',
                        '\\mod_scorm\\event\\course_module_instance_list_viewed',
                        '\\mod_scorm\\event\\course_module_viewed',
                        '\\mod_scorm\\event\\sco_launched',
                        '\\mod_scorm\\event\\scoreraw_submitted',
                        '\\mod_scorm\\event\\status_submitted',
                        '\\mod_survey\\event\\course_module_instance_list_viewed',
                        '\\mod_survey\\event\\course_module_viewed',
                        '\\mod_survey\\event\\response_submitted',
                        '\\tool_usertours\\event\\tour_ended',
                        '\\tool_usertours\\event\\tour_started',
                        '\\mod_url\\event\\course_module_instance_list_viewed',
                        '\\mod_url\\event\\course_module_viewed',
                        '\\mod_wiki\\event\\course_module_instance_list_viewed',
                        '\\mod_wiki\\event\\course_module_viewed',
                        '\\mod_wiki\\event\\comment_created',
                        '\\mod_wiki\\event\\comment_deleted',
                        '\\mod_wiki\\event\\comments_viewed',
                        '\\mod_wiki\\event\\page_created',
                        '\\mod_wiki\\event\\page_deleted',
                        '\\mod_wiki\\event\\page_diff_viewed',
                        '\\mod_wiki\\event\\page_history_viewed',
                        '\\mod_wiki\\event\\page_map_viewed',
                        '\\mod_wiki\\event\\page_updated',
                        '\\mod_wiki\\event\\page_version_deleted',
                        '\\mod_wiki\\event\\page_version_restored',
                        '\\mod_wiki\\event\\page_version_viewed',
                        '\\mod_wiki\\event\\page_viewed',
                        '\\mod_wooclap\\event\\course_module_instance_list_viewed',
                        '\\mod_wooclap\\event\\course_module_viewed',
                        '\\mod_workshop\\event\\assessable_uploaded',
                        '\\mod_workshop\\event\\course_module_instance_list_viewed',
                        '\\mod_workshop\\event\\course_module_viewed',
                        '\\mod_workshop\\event\\submission_assessed',
                        '\\mod_workshop\\event\\submission_created',
                        '\\mod_workshop\\event\\submission_deleted',
                        '\\mod_workshop\\event\\submission_reassessed',
                        '\\mod_workshop\\event\\submission_updated',
                        '\\mod_workshop\\event\\submission_viewed',
                        '\\totara_program\\event\\program_assigned'
    )
)
ORDER BY L.id DESC
```

Note that you may want to add a `WHERE` clause to this SQL query if you only want to process some past events. For example, if you only wanted to process past events between `2018-01-01T00:00Z` and `2018-01-02T00:00Z` you would use the `WHERE` clause below, where the dates have been [converted to Unix timestamp integers](http://www.4webhelp.net/us/timestamp.php?action=date&day=01&month=01&year=2018&hour=00&minute=00&second=00&timezone=0). 

```sql
WHERE timecreated BETWEEN 1514764800 AND 1514851200
```

Once this SQL query has been executed, the plugin will start processing the events each time the Moodle Cron script is executed. Note that you can [run the Moodle Cron script manually](https://docs.moodle.org/20/en/Cron#Testing_cron_and_manual_trigger) if you want to and you can change the "Maximum batch size" in the plugin settings (which defaults to 30) in order to speed things up.

If you have a quick question about this process, please ask in [our Gitter chat room](https://gitter.im/LearningLocker/learninglocker) ðŸ’¬, if you think there's a problem with this guide, please create a new issue in [our Github issue tracker](https://github.com/xAPI-vle/moodle-logstore_xapi/issues).
